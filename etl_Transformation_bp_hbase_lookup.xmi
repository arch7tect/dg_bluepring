<?xml version="1.0" encoding="ASCII"?>
<etl:Transformation xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:etl="http://www.neoflex.ru/meta/etl" name="bp_hbase_lookup" label="bp_hbase_lookup" jsonView="{&quot;cells&quot;:[{&quot;type&quot;:&quot;devs.transformation.ExpressionSource&quot;,&quot;size&quot;:{&quot;width&quot;:80,&quot;height&quot;:80},&quot;inPorts&quot;:[],&quot;outPorts&quot;:[&quot;out&quot;],&quot;ports&quot;:{&quot;groups&quot;:{&quot;in&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;white&quot;,&quot;magnet&quot;:&quot;passive&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;,&quot;args&quot;:{&quot;y&quot;:10}}}},&quot;out&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;,&quot;args&quot;:{&quot;y&quot;:10}}},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;#4d4d4dde&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10,&quot;magnet&quot;:true},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}}}},&quot;items&quot;:[{&quot;id&quot;:&quot;out&quot;,&quot;group&quot;:&quot;out&quot;,&quot;attrs&quot;:{&quot;.port-label&quot;:{&quot;text&quot;:&quot;out&quot;}}}]},&quot;position&quot;:{&quot;x&quot;:60,&quot;y&quot;:210},&quot;angle&quot;:0,&quot;id&quot;:&quot;3392d4da-02eb-4ac4-b42c-d76e5eefa813&quot;,&quot;z&quot;:1,&quot;name&quot;:&quot;Expression_0&quot;,&quot;attrs&quot;:{&quot;.label&quot;:{&quot;text&quot;:&quot;Expression_0&quot;}}},{&quot;type&quot;:&quot;devs.transformation.SparkSQL&quot;,&quot;size&quot;:{&quot;width&quot;:80,&quot;height&quot;:80},&quot;inPorts&quot;:[&quot;sqlin&quot;],&quot;outPorts&quot;:[&quot;out&quot;],&quot;ports&quot;:{&quot;groups&quot;:{&quot;in&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;white&quot;,&quot;magnet&quot;:&quot;passive&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;,&quot;args&quot;:{&quot;y&quot;:10}}}},&quot;out&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;,&quot;args&quot;:{&quot;y&quot;:10}}},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;#4d4d4dde&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10,&quot;magnet&quot;:true},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}}}},&quot;items&quot;:[{&quot;id&quot;:&quot;out&quot;,&quot;group&quot;:&quot;out&quot;,&quot;attrs&quot;:{&quot;.port-label&quot;:{&quot;text&quot;:&quot;out&quot;}}},{&quot;id&quot;:&quot;0&quot;,&quot;multiple&quot;:true,&quot;group&quot;:&quot;in&quot;,&quot;attrs&quot;:{&quot;.port-label&quot;:{&quot;text&quot;:&quot;seq&quot;,&quot;visibility&quot;:&quot;visible&quot;},&quot;circle&quot;:{&quot;fill&quot;:&quot;white&quot;,&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}}}]},&quot;position&quot;:{&quot;x&quot;:270,&quot;y&quot;:210},&quot;angle&quot;:0,&quot;id&quot;:&quot;be096d39-f9fc-487e-a6e9-edd5b49e63dd&quot;,&quot;z&quot;:2,&quot;name&quot;:&quot;Spark_SQL_1&quot;,&quot;attrs&quot;:{&quot;.label&quot;:{&quot;text&quot;:&quot;Spark_SQL_1&quot;}}},{&quot;type&quot;:&quot;devs.transformation.LocalTarget&quot;,&quot;size&quot;:{&quot;width&quot;:80,&quot;height&quot;:80},&quot;inPorts&quot;:[&quot;in&quot;],&quot;outPorts&quot;:[],&quot;ports&quot;:{&quot;groups&quot;:{&quot;in&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;white&quot;,&quot;magnet&quot;:&quot;passive&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;,&quot;args&quot;:{&quot;y&quot;:10}}}},&quot;out&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;,&quot;args&quot;:{&quot;y&quot;:10}}},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;#4d4d4dde&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10,&quot;magnet&quot;:true},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}}}},&quot;items&quot;:[{&quot;id&quot;:&quot;in&quot;,&quot;group&quot;:&quot;in&quot;,&quot;attrs&quot;:{&quot;.port-label&quot;:{&quot;text&quot;:&quot;in&quot;}}}]},&quot;position&quot;:{&quot;x&quot;:480,&quot;y&quot;:210},&quot;angle&quot;:0,&quot;id&quot;:&quot;fec798fb-3a0c-4f22-ba3f-7ced1e897500&quot;,&quot;z&quot;:3,&quot;name&quot;:&quot;Local_3&quot;,&quot;attrs&quot;:{&quot;.label&quot;:{&quot;text&quot;:&quot;Local_3&quot;}}},{&quot;type&quot;:&quot;devs.transformation.Flow&quot;,&quot;source&quot;:{&quot;id&quot;:&quot;3392d4da-02eb-4ac4-b42c-d76e5eefa813&quot;,&quot;port&quot;:&quot;out&quot;},&quot;target&quot;:{&quot;id&quot;:&quot;be096d39-f9fc-487e-a6e9-edd5b49e63dd&quot;,&quot;port&quot;:&quot;0&quot;},&quot;id&quot;:&quot;bc3c3e5c-bf5c-4540-be32-1d4e9c8b8ce8&quot;,&quot;z&quot;:4,&quot;name&quot;:&quot;2610928e-09f3-4787-ac46-e56359be85cc&quot;,&quot;attrs&quot;:{&quot;.label&quot;:{&quot;text&quot;:&quot;2610928e-09f3-4787-ac46-e56359be85cc&quot;}}},{&quot;type&quot;:&quot;devs.transformation.Flow&quot;,&quot;source&quot;:{&quot;id&quot;:&quot;be096d39-f9fc-487e-a6e9-edd5b49e63dd&quot;,&quot;port&quot;:&quot;out&quot;},&quot;target&quot;:{&quot;id&quot;:&quot;fec798fb-3a0c-4f22-ba3f-7ced1e897500&quot;,&quot;port&quot;:&quot;in&quot;},&quot;id&quot;:&quot;5e56a512-a7ea-4385-9f77-8fe660095b90&quot;,&quot;z&quot;:5,&quot;name&quot;:&quot;71320cc8-a61d-4fe0-be65-017524f6e7b2&quot;,&quot;attrs&quot;:{&quot;.label&quot;:{&quot;text&quot;:&quot;71320cc8-a61d-4fe0-be65-017524f6e7b2&quot;}}}]}">
  <targets xsi:type="etl:LocalTarget" name="Local_3" label="Local_3" localFileName="/tmp/blueprint/hbase_lookup_result" saveMode="OVERWRITE">
    <inputPort name="Local_3in"/>
  </targets>
  <transformationSteps xsi:type="etl:SparkSQL" name="Spark_SQL_1" label="Spark_SQL_1" statement="with seqlk as (&#xA;  select &#xA;    s.id as id, &#xA;    HBASE_LOOKUP('address', '0:cust_id;0:address;0:main', LONG2BINARY(s.id)) as arr&#xA;  from seq s&#xA;)&#xA;select &#xA;    lk.id,&#xA;    BINARY2LONG(lk.arr[0]) as cust_id,&#xA;    BINARY2STRING(lk.arr[1]) as address,&#xA;    BINARY2BOOLEAN(lk.arr[2]) as main&#xA;from seqlk lk&#xA;">
    <outputPort name="Spark_SQL_1out"/>
    <sqlPorts name="seq" alias="seq">
      <fields name="id" dataTypeDomain="LONG"/>
    </sqlPorts>
  </transformationSteps>
  <sources xsi:type="etl:ExpressionSource" name="Expression_0" label="Expression_0" expression="(10L to 21L).map(id=>Map(&quot;id&quot;->id.asInstanceOf[AnyRef]))&#xA;">
    <outputPort name="Expression_0out">
      <fields name="id" dataTypeDomain="LONG"/>
    </outputPort>
  </sources>
  <transitions name="2610928e-09f3-4787-ac46-e56359be85cc" start="//@sources.0/@outputPort" finish="//@transformationSteps.0/@sqlPorts.0"/>
  <transitions name="71320cc8-a61d-4fe0-be65-017524f6e7b2" start="//@transformationSteps.0/@outputPort" finish="//@targets.0/@inputPort"/>
  <auditInfo changeUser="orlov" changeDateTime="2019-04-14T16:27:44.853+0300" createUser="orlov" createDateTime="2019-04-14T16:26:00.649+0300"/>
</etl:Transformation>
